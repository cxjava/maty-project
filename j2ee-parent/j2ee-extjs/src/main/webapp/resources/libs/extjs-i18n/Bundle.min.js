/**
 * @author Maximiliano Fierro
 * @class Ext.i18n.Bundle
 * @extends Ext.data.Store
 */Ext.define("Ext.i18n.reader.Property",{extend:"Ext.data.reader.Json",alias:"reader.property",constructor:function(a){a=a||{},Ext.applyIf(a,{idProperty:"key",successProperty:"success",totalProperty:"total"}),this.callParent([a])},getResponseData:function(a){return this.readRecords(a)},getData:function(a){var b=[],c,d,e=this.readLines(a),f=e.length;for(var g=0;g<f;g++){var h=e[g].search(/[\s:=]/);c={value:this.clearValueExtraChars(e[g].substring(h+1)),key:this.clearKeyExtraChars(e[g].substring(0,h))},b[g]=c}return b},clearKeyExtraChars:function(a){return a?a.replace(/[:=]/gi,""):""},clearValueExtraChars:function(a){return a?a.replace(/\\\s*\n/gi,""):""},readLines:function(a){var b=a.responseText;return b?b.match(/.*(.*\\\s*\n)+.*|^((?!^\s*[#!]).).*$/gim):[]}}),Ext.define("Ext.i18n.model.Property",{extend:"Ext.data.Model",idProperty:"key",fields:["key","value"]}),Ext.define("Ext.i18n.Bundle",{extend:"Ext.data.Store",defaultLanguage:"en-US",resourceExt:".properties",config:{bundle:"message",path:"resources"},constructor:function(a){a=a||{};var b=this,c=b.formatLanguageCode(a.lang||b.guessLanguage()),d=a.noCache!==!1,e;b.language=c,b.bundle=a.bundle||b.bundle,b.path=a.path||b.path,e=b.buildURL(c),delete a.lang,delete a.noCache,Ext.applyIf(a,{autoLoad:!0,model:"Ext.i18n.model.Property",proxy:{type:"ajax",url:e,noCache:d,reader:{type:"property"},getParams:Ext.emptyFn},listeners:{load:b.onBundleLoad,scope:b}}),b.callParent([a]),b.getProxy().on("exception",b.loadParent,b,{single:b});var f=window.t;b.noConflict=function(){return window.t=f,b.getMsg},window.lang=b,window.t=b.getMsg},guessLanguage:function(){return navigator.language||navigator.browserLanguage||navigator.userLanguage||this.defaultLanguage},getMsg:function(a){var b=Ext.Array.toArray(arguments,1),c,d=lang.getById(a);return c=d?Ext.util.Format.htmlDecode(d.get("value")):a+".undefined",c.replace(/\{(\d+)\}/g,function(a,c){return b[c]})},onReady:function(a){var b=this;b.readyFn=a,b.on("loaded",b.readyFn,b)},onBundleLoad:function(a,b,c,d){c&&this.fireEvent("loaded")},onProxyLoad:function(a){a.getRecords()&&this.callParent(arguments)},buildURL:function(a){var b=this,c="";return b.path&&(c+=b.path+"/"),c+=b.bundle,a&&(c+="_"+a),c+=b.resourceExt,c},loadParent:function(){this.getProxy().url=this.buildURL(),this.load()},formatLanguageCode:function(a){return a}});