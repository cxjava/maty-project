Ext.define("Ext.i18n.reader.Property",{extend:"Ext.data.reader.Json",alias:"reader.i18n.property",constructor:function(){var e,t=this;t.callParent(arguments),e=t.model,e&&Ext.merge(e.prototype,{idProperty:this.getIdProperty(),idgen:{getRecId:function(e){return e.internalId}}})},getResponseData:function(e){return this.readRecords(e)},getData:function(e){for(var t,n=[],r=this.readLines(e),a=r.length,o=0;a>o;o++){var i=r[o].search(/[\s:=]/);t={value:this.clearValueExtraChars(r[o].substring(i+1)),key:this.clearKeyExtraChars(r[o].substring(0,i))},n[o]=t}return n},clearKeyExtraChars:function(e){return e?e.replace(/[:=]/gi,""):""},clearValueExtraChars:function(e){return e?e.replace(/\\\s*\n/gi,""):""},readLines:function(e){var t=e.responseText;return t?t.match(/.*(.*\\\s*\n)+.*|^((?!^\s*[#!]).).*$/gim):[]}}),Ext.define("Ext.i18n.reader.Json",{extend:"Ext.data.reader.Json",alias:"reader.i18n.json",constructor:function(){var e,t=this;t.callParent(arguments),e=t.model,e&&Ext.merge(e.prototype,{idProperty:this.getIdProperty(),idgen:{getRecId:function(e){return e.internalId}}})},extractData:function(e){var t,n,r,a,o,i,u,s,d=this,l=[],c=d.model,g=e.length;for(!e.length&&Ext.isObject(e)&&(t=d.getKeys(e),g=t.length),s=0;g>s;s++){for(n=t[s],r=n.split("."),j=0,a=e;r.length>j;j++)a=a[r[j]];i={key:n,value:a},u=new c(void 0,d.getId(i),i,o={}),u.phantom=!1,d.convertRecordData(o,i,u),l.push(u)}return l},getKeys:function(e){function t(e,n){var r,a=n||"";for(r in e)if(e.hasOwnProperty(r))return a=(a?a+".":"")+r,Ext.isObject(e[r])&&(a=t(e[r],a)),a}var n,r=[];for(n in e)e.hasOwnProperty(n)&&(Ext.isObject(e[n])?r.push(t(e[n],n)):r.push(n));return r}}),Ext.define("Ext.i18n.Bundle",{extend:"Ext.data.Store",defaultLanguage:"en-US",config:{autoLoad:!1,fields:["key","value"],bundle:"message",format:"property",path:"resources"},constructor:function(e){e=e||{};var t,n=this,r=n.formatLanguageCode(e.lang||n.guessLanguage()),a=e.noCache!==!1;n.language=r,n.bundle=e.bundle||n.bundle,n.path=e.path||n.path,n.format=e.format||n.format,t=this.buildURL(r),delete e.lang,delete e.noCache,Ext.applyIf(e,{proxy:{type:"ajax",url:t,noCache:a,reader:{type:"i18n."+n.format,idProperty:"key"},getParams:Ext.emptyFn}}),n.callParent([e]),n.on("load",n.onBundleLoad,n),n.getProxy().on("exception",n.loadParent,n,{single:n});var o=window.t;n.noConflict=function(){return window.t=o,n.getMsg},window.lang=n,window.t=n.getMsg},guessLanguage:function(){return navigator.language||navigator.browserLanguage||navigator.userLanguage||this.defaultLanguage},getMsg:function(e){var t,n=[].splice.call(arguments,1),r=lang.getById(e),a=e+".undefined";return r&&(a=Ext.util.Format.htmlDecode(r.get("value")),n&&(t=[a].concat(n),a=Ext.String.format.apply(null,t))),a},onReady:function(e){var t=this;t.readyFn=e,t.on("loaded",t.readyFn,t)},onBundleLoad:function(e,t,n){n&&this.fireEvent("loaded")},onProxyLoad:function(e){e.getRecords()&&this.callParent(arguments)},getResourceExtension:function(){return"property"===this.format?".properties":".json"},buildURL:function(e){var t=this,n="";return t.path&&(n+=t.path+"/"),n+=t.bundle,e&&(n+="_"+e),n+=t.getResourceExtension()},loadParent:function(){this.getProxy().url=this.buildURL(),this.load()},formatLanguageCode:function(e){var t,n,r=e.split("_");return t=r[0]?r[0].toLowerCase():"",n=r[1]?r[1].toUpperCase():"",r.length>1?[t,n].join("_"):t}},function(){Ext.override(Ext.app.Application,{onBeforeLaunch:function(){var e,t=this,n=this.onBeforeLaunch.$previous;e=Ext.namespace(t.name),e&&(e.getApplication=function(){return t}),t.bundle?t.bundle=Ext.create("Ext.i18n.Bundle",Ext.apply({autoLoad:!0,listeners:{loaded:function(){n.apply(t)}}},t.bundle)):t.callOverridden()}})});