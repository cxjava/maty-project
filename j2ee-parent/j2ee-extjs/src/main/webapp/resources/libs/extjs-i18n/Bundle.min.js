Ext.define("Ext.i18n.reader.Property",{extend:"Ext.data.reader.Json",alias:"reader.property",constructor:function(e){e=e||{},Ext.applyIf(e,{idProperty:"key",successProperty:"success",totalProperty:"total"}),this.callParent([e])},getResponseData:function(e){return this.readRecords(e)},getData:function(e){var t=[],n,r,i=this.readLines(e),s=i.length;for(var o=0;o<s;o++){var u=i[o].search(/[\s:=]/);n={value:this.clearValueExtraChars(i[o].substring(u+1)),key:this.clearKeyExtraChars(i[o].substring(0,u))},t[o]=n}return t},clearKeyExtraChars:function(e){return e?e.replace(/[:=]/gi,""):""},clearValueExtraChars:function(e){return e?e.replace(/\\\s*\n/gi,""):""},readLines:function(e){var t=e.responseText;return t?t.match(/.*(.*\\\s*\n)+.*|^((?!^\s*[#!]).).*$/gim):[]}}),Ext.define("Ext.i18n.model.Property",{extend:"Ext.data.Model",idProperty:"key",fields:["key","value"]}),Ext.define("Ext.i18n.Bundle",{extend:"Ext.data.Store",defaultLanguage:"en-US",resourceExt:".properties",config:{bundle:"message",path:"resources"},constructor:function(e){e=e||{};var t=this,n=t.formatLanguageCode(e.lang||t.guessLanguage()),r=e.noCache!==!1,i;t.language=n,t.bundle=e.bundle||t.bundle,t.path=e.path||t.path,i=this.buildURL(n),delete e.lang,delete e.noCache,Ext.applyIf(e,{autoLoad:!0,model:"Ext.i18n.model.Property",proxy:{type:"ajax",url:i,noCache:r,reader:{type:"property"},getParams:Ext.emptyFn},listeners:{load:this.onBundleLoad,scope:this}}),t.callParent([e]),t.getProxy().on("exception",this.loadParent,this,{single:!0})},guessLanguage:function(){return navigator.language||navigator.browserLanguage||navigator.userLanguage||this.defaultLanguage},getMsg:function(e){var t=Ext.Array.toArray(arguments,1),n,r=this.getById(e);return n=r?Ext.util.Format.htmlDecode(r.get("value")):e+".undefined",n.replace(/\{(\d+)\}/g,function(e,n){return t[n]})},onReady:function(e){this.readyFn=e,this.on("loaded",this.readyFn,this)},onBundleLoad:function(e,t,n,r){n&&this.fireEvent("loaded")},onProxyLoad:function(e){e.getRecords()&&this.callParent(arguments)},buildURL:function(e){var t="";return this.path&&(t+=this.path+"/"),t+=this.bundle,e&&(t+="_"+e),t+=this.resourceExt,t},loadParent:function(){this.getProxy().url=this.buildURL(),this.load()},formatLanguageCode:function(e){var t=e.split("_");return t[0]=t[0]?t[0].toLowerCase():"",t[1]=t[1]?t[1].toUpperCase():"",t.join("_")}});