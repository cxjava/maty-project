/**
 * @author Maximiliano Fierro
 * @class Ext.i18n.Bundle
 * @extends Ext.data.Store
 */
Ext.define("Ext.i18n.reader.Property",{extend:"Ext.data.reader.Json",alias:"reader.property",constructor:function(a){a=a||{},Ext.applyIf(a,{idProperty:"key",successProperty:"success",totalProperty:"total"}),this.callParent([a])},getResponseData:function(a){return this.readRecords(a)},getData:function(a){var b=[],c,d,e=this.readLines(a),f=e.length;for(var g=0;g<f;g++){var h=e[g].search(/[\s:=]/);c={value:this.clearValueExtraChars(e[g].substring(h+1)),key:this.clearKeyExtraChars(e[g].substring(0,h))},b[g]=c}return b},clearKeyExtraChars:function(a){return a?a.replace(/[:=]/gi,""):""},clearValueExtraChars:function(a){return a?a.replace(/\\\s*\n/gi,""):""},readLines:function(a){var b=a.responseText;return b?b.match(/.*(.*\\\s*\n)+.*|^((?!^\s*[#!]).).*$/gim):[]}});
Ext.define("Ext.i18n.model.Property",{extend:"Ext.data.Model",idProperty:"key",fields:["key","value"]});
Ext.define("Ext.i18n.Bundle",{extend:"Ext.data.Store",defaultLanguage:"en-US",resourceExt:".properties",config:{bundle:"message",path:"resources"},constructor:function(e){e=e||{};var t=this,n=t.formatLanguageCode(e.lang||t.guessLanguage()),r=e.noCache!==!1,i;t.language=n,t.bundle=e.bundle||t.bundle,t.path=e.path||t.path,i=this.buildURL(n),delete e.lang,delete e.noCache,Ext.applyIf(e,{autoLoad:!0,model:"Ext.i18n.model.Property",proxy:{type:"ajax",url:i,noCache:r,reader:{type:"property"},getParams:Ext.emptyFn},listeners:{load:this.onBundleLoad,scope:this}}),t.callParent([e]),t.getProxy().on("exception",this.loadParent,this,{single:!0})},guessLanguage:function(){return navigator.language||navigator.browserLanguage||navigator.userLanguage||this.defaultLanguage},getMsg:function(e){var t=this.getById(e);return console.log(e),console.log(t),t?Ext.util.Format.htmlDecode(t.get("value")):e+".undefined"},onReady:function(e){this.readyFn=e,this.on("loaded",this.readyFn,this)},onBundleLoad:function(e,t,n,r){n&&this.fireEvent("loaded")},onProxyLoad:function(e){e.getRecords()&&this.callParent(arguments)},buildURL:function(e){var t="";return this.path&&(t+=this.path+"/"),t+=this.bundle,e&&(t+="_"+e),t+=this.resourceExt,t},loadParent:function(){this.getProxy().url=this.buildURL(),this.load()},formatLanguageCode:function(e){var t=e.split("_");return t[0]=t[0]?t[0].toLowerCase():"",t[1]=t[1]?t[1].toUpperCase():"",t.join("_")}});